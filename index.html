<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário Empresárial</title>
    <link rel="shortcut icon" href="icones/lista-de-controle.gif" type="image/x-icon">
    <link rel="stylesheet" href="estilo.css">
</head>
<body>

    <h1 id="nome">Formulário da Empresa Romano</h1>

    <nav>
        <ul>

            <li><a href="cadastrar-cliente.html">Cadastrar Cliente</a></li>

            <li><a href="index.html" class="active">Cadastrar Produto</a></li>
            
            <li><a href="produtos.html">Ver Estoque</a></li>

            <li><a href="saida.html">Registrar Saída</a></li>

            <li><a href="relatorios.html">Relatórios</a></li>

            <li><a href="clientes.html">Clientes</a></li>
            
        </ul>
    </nav>
    <header>
        <h1>Formulário de Cadastro de Produtos</h1>
        <p>Insira os dados do produto para cadastrar no sistema.</p>
        <br>
        <a href="estoque-baixo.html">Produtos com Estoque Baixo</a>
        <br>

        <video src="icones/caderno.mp4" width="150" height="150" autoplay loop muted controls>
            Seu navegador não suporta o elemento de vídeo.
        </video>
    </header>
    <main>
        <form id="product-form">
            <fieldset>
                <legend>Informações do Produto</legend>

                <div>
                    <label for="nome-produto">Nome do Produto:</label><br>
                    <select id="nome-produto" name="nome_produto" required>
                        <option value="" disabled selected>Selecione um produto</option>
                        <option value="camiseta-branca">Camiseta Branca</option>
                        <option value="calca-jeans">Calça Jeans</option>
                        <option value="tenis-esportivo">Tênis Esportivo</option>
                        <option value="moletom-preto">Moletom Preto</option>
                        <option value="bermuda-tactel">Bermuda Tactel</option>
                        <option value="vestido-floral">Vestido Floral</option>
                        <option value="sapato-social">Sapato Social</option>
                        <option value="jaqueta-couro">Jaqueta de Couro</option>
                        <option value="oculos-sol">Óculos de Sol</option>
                        <option value="relogio-pulso">Relógio de Pulso</option>
                    </select>
                </div>
                <br>
                <div>
                    <label for="estoque">Quantidade em Estoque:</label><br>
                    <input type="number" id="estoque" name="estoque" min="0" placeholder="Ex: 100" required>
                    <small id="alerta-estoque" style="color: red; display: none;">Atenção: Estoque baixo!</small>
                </div>
                <br>
                <div>
                    <label for="valor-compra">Preço de Compra (R$):</label><br>
                    <input type="number" id="valor-compra" name="valor_compra" min="0.01" step="0.01" placeholder="Ex: 29.90" required>
                </div>
                <br>
                <div>
                    <label for="valor-venda">Preço de Venda (R$):</label><br>
                    <input type="number" id="valor-venda" name="valor_venda" min="0.01" step="0.01" placeholder="Ex: 49.90" required>
                </div>
            </fieldset>
            <br>
            <button type="submit">Cadastrar Produto</button>
        </form>
        <br>
        <a href="produtos.html">Ver Produtos Cadastrados</a>

        <script>
            const productForm = document.getElementById('product-form');
            const estoqueInput = document.getElementById('estoque');
            const alertaEstoque = document.getElementById('alerta-estoque');

            // Adiciona um "ouvinte" para o alerta de estoque baixo
            estoqueInput.addEventListener('input', function() {
                const quantidade = parseInt(this.value, 10);
                const limiteEstoqueBaixo = 10;
                alertaEstoque.style.display = (quantidade <= limiteEstoqueBaixo && this.value !== '') ? 'block' : 'none';
            });

            // Adiciona um "ouvinte" para o envio do formulário
            productForm.addEventListener('submit', function(event) {
                event.preventDefault(); // Impede o envio padrão do formulário

                // Pega os valores dos campos
                const nomeProdutoSelect = document.getElementById('nome-produto');
                const produtoId = nomeProdutoSelect.value;
                const nomeProduto = nomeProdutoSelect.options[nomeProdutoSelect.selectedIndex].text;
                const quantidade = parseInt(document.getElementById('estoque').value, 10);
                const valorCompra = parseFloat(document.getElementById('valor-compra').value).toFixed(2);
                const valorVenda = parseFloat(document.getElementById('valor-venda').value).toFixed(2);

                // Pega os produtos já salvos no localStorage ou cria uma lista vazia
                const produtosSalvos = JSON.parse(localStorage.getItem('produtos')) || [];
                
                // Verifica se o produto já existe
                const indexExistente = produtosSalvos.findIndex(p => p.id === produtoId);

                if (indexExistente !== -1) {
                    // Se existe, soma a quantidade e atualiza os preços
                    produtosSalvos[indexExistente].quantidade = parseInt(produtosSalvos[indexExistente].quantidade) + quantidade;
                    produtosSalvos[indexExistente].valorCompra = valorCompra;
                    produtosSalvos[indexExistente].valorVenda = valorVenda;
                    alert('Produto já existente! Estoque atualizado com sucesso.');
                } else {
                    // Se não existe, cria um novo
                    const produto = {
                        id: produtoId,
                        nome: nomeProduto,
                        quantidade: quantidade,
                        valorCompra: valorCompra,
                        valorVenda: valorVenda
                    };
                    produtosSalvos.push(produto);
                    alert('Produto cadastrado com sucesso!');
                }

                localStorage.setItem('produtos', JSON.stringify(produtosSalvos));

                productForm.reset(); // Limpa o formulário
            });
        </script>
    </main>
</body>
</html>